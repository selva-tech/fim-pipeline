configuration:
  dependencies:
  - "mvn://com.walmartlabs.concord.plugins:jira-task:1.39.0"
  - mvn://com.squareup.okio:okio:1.13.0
  - mvn://com.squareup.okhttp3:okhttp:3.9.1
  arguments:
    jiraParams:
      apiUrl: "https://macefimeteam.atlassian.net/rest/api/2/"
flows:
  default:
    - task: http
      in:
        auth:
          basic:
            token: "${crypto.exportAsString('Default', 'jira-apikey',null)}"
        request: json
        method: POST
        url: "https://macefimeteam.atlassian.net/rest/api/3/issuet"
        body: |
          {
           "fields": {
             "project":
               {
                  "key": "WEB"
               },
               "summary": "REST ye merry gentlemen.",
               "description": "Creating of an issue using project keys and issue type names using the REST API",
               "issuetype": {
                  "name": "Bug"
               }
           }
        }
        response: json
        out: jsonResponse
    - if: ${jsonResponse.success}
      then:
       - log: "Response received: ${jsonResponse.content}"

    - log: "Done!"

