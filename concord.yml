configuration:
  dependencies:
  - "mvn://com.walmartlabs.concord.plugins:jira-task:1.39.0"
  - mvn://com.squareup.okio:okio:1.13.0
  - mvn://com.squareup.okhttp3:okhttp:3.9.1

flows:
  default:
    - log: "Hello, ${fimName} - ${fimLines} - ${fimHost}"
    - task: http
      in:
        auth:
          basic:
            username: mselvarajumca@gmail.com
            password: "${crypto.exportAsString('Default', 'jira-apikey',null)}"
        request: json
        method: POST
        url: "https://macefimeteam.atlassian.net/rest/api/2/issue"
        body: |
          {
           "fields": {
             "project":
               {
                  "key": "WEB"
               },
               "summary": "FIM A file has been changed - ${fimName} -  ${fimHost}",
               "description": "FIM A file has been changed - ${fimName} -  ${fimHost} - \n  ${fimLines} ",
               "issuetype": {
                  "name": "Bug"
               }
            }
          }
        response: json
        out: jsonResponse
    - if: ${jsonResponse.success}
      then:
       - log: "Response received: ${jsonResponse.content}"

    - log: "Done!"

